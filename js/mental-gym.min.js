let currPage=-1,currActive=-1,selIndex=-1,arousalRunning=!1;const iframeIntervalTimeVal=1e3,breathingIntervalTimeVal=30;let curBreatheTime=0,curMultiBreatheTime=0,curBreatheTotalTime=0,curMultiBreatheTotalTime=0,mentalRelaxationRewardPoint=0,aTime=0,bTime=0,cTime=0,dTime=[0,0,0],bodyRelaxationRewardPoint=0,previousTemperatureValue=0,greatestTempValue=0,mindBodyBalanceRewardPoint=0,multi_lf_dominantCount=0,balance_lf_dominantCount=0,hrv_lf_dominantCount=0,notePosition=0,temporaryTemperatureValue=0,greatestTempValueInCelsius=0;const increaseVal=.5,itemsCount=1500;let isSoundEnable=!1,isPreviousArousalValueReplaced=!1,lastHandled=!1,iframeLoaded=!1,heartRateRunning=!1,tempRunning=!1,breatheRunning=!1,isSoundTriggered=!0,isCelsius=!0;const noteList=["C2","D2","E2","F2","G2","A2","B2","C3","D3","E3","F3","G3","A3","B3","C4","D4","E4","F4","G4","A4","B4"];let breatheData=[];const _el=e=>document.querySelector(e),arousalVideo=_el("#arousalVideo"),arousalIframe=_el("#arousalIframe"),tempVideo=_el("#TempVideo"),tempIframe=_el("#TempIframe"),tempValue=_el("#temp-value"),sliderPercent=_el("#SliderPercent"),sliderCircle=_el("#SliderCircle"),balanceSliderPercent=_el("#BalanceSliderPercent"),bloodPressureVideo=_el("#bloodPressureVideo"),bloodPressureIframe=_el("#bloodPressureIframe"),balanceSliderCircle=_el("#BalanceSliderCircle"),bodyRelaxationPoint=_el("#bodyRelaxationPoint"),arousalAnimVideo=_el(".arousalAnimVideo"),hrvVideoContainer=_el(".hrvVideoContainer"),hrvVideo=_el("#hrvVideo"),hrvIframe=_el("#hrvIframe");let initArousal=null,breathingInterval=null,arousalChart=null,hrvChart=null,tempChart=null,previousArousalValue=null,iframeReloadInterval=null,bloodPressureChart1_2=null,bloodPressureChart2=null,multiArousalChart=null,multiTempChart=null,multiBeatChart=null,multiBVPChart=null,initTemp=null,initHr=null,initBp=null,initTempInCelsius=null,initTempInFahrenheit=null,balanceBar=null,hrvBar=null;const asc=e=>e.sort(((e,t)=>e-t)),quantile=(e,t)=>{const a=(e.length-1)*t,n=Math.floor(a);return void 0!==e[n+1]?e[n]+(a-n)*(e[n+1]-e[n]):e[n]};function showSelectedPage(e){selIndex=e,currPage=e,_el("[data-pageindex='"+e+"']").style.display="block",history.pushState({state:e},"State "+e,"?state="+e)}function setPageHidden(){switch(_el("[data-pageindex='"+selIndex+"']").style.transform="translateY(0vh)",_el(".Page").classList.contains("hidden")||(_el(".Page").classList+=" hidden"),selIndex){case 0:aTime=0,mentalRelaxationRewardPoint=0,loadArousal();break;case 1:hrv_lf_dominantCount=0,bTime=0,loadHRV(),renderBreathePath();break;case 2:cTime=0,loadTemp();break;case 3:dTime=[0,0,0],multi_lf_dominantCount=0,loadMultiChannel(),renderMultiBreathePath();break;case 4:multi_lf_dominantCount=0,balance_lf_dominantCount=0,loadBloodPressure()}}function emitSound(){if(!isSoundTriggered)return;isSoundTriggered=!1;(new Tone.Synth).toDestination().triggerAttackRelease(noteList[notePosition],"4n"),setTimeout((()=>{isSoundTriggered=!0}),500)}function updateCookie(e,t,a){e.innerHTML=parseFloat(e.innerHTML)+.5*a,setCookie(t,e.innerHTML,exDays),renderBreathePath()}function setActivePage(e){currActive=e,currPage=e,selIndex=e;const t=_el(".TrainingOptions").children;for(let a=0;a<t.length;a++)a!==e&&(_el("[data-pageindex='"+a+"']").style.display="none")}function handleMessage(e){if(-1===currActive)return;if(!e.data)return;let t=JSON.parse(e.data);if(t||t.values){lastHandled=!0,iframeLoaded=!0,1===currActive&&(hrv_lf_dominantCount=0,mindBodyBalanceRewardPoint=0);for(let e=0;e<t.values.length;e++)switch(currActive){case 0:if(!arousalRunning)continue;const a=parseInt(t.values[e].gs);if(isNaN(a))continue;if(null===initArousal)initArousal=a,notePosition=21,aTime=0;else{const e=arousalVideo.currentTime>0&&!arousalVideo.paused&&!arousalVideo.ended&&arousalVideo.readyState>arousalVideo.HAVE_CURRENT_DATA;"none"!==arousalVideo.style.display?e&&arousalVideo.pause():arousalIframe.contentWindow.postMessage('{"event":"command","func":"pauseVideo","args":""}',"*"),0!==arousalAnimVideo.getBoundingClientRect().width&&initArousal<a&&("none"!==arousalVideo.style.display?e||arousalVideo.play().then((()=>{})):arousalIframe.contentWindow.postMessage('{"event":"command","func":"playVideo","args":""}',"*"))}arousalChart&&(arousalChart.series[0].update({zones:[{value:initArousal,color:"#67caf2"},{color:"#ff8382"}]}),arousalChart.series[0].data.length>=1500?arousalChart.series[0].addPoint([aTime,a],!0,!0):arousalChart.series[0].addPoint([aTime,a],!0,!1)),notePosition=Math.floor((a-25e3)/5e3*noteList.length),_el("#ArousalVal").innerHTML="AROUSAL LEVEL = "+a,initArousal>a&&(mentalRelaxationRewardPoint+=.5),isSoundEnable&&emitSound(),isPreviousArousalValueReplaced||(previousArousalValue=a,isPreviousArousalValueReplaced=!0,setTimeout((()=>{isPreviousArousalValueReplaced=!1}),500)),_el("#mentalRelaxationPoint").innerHTML=mentalRelaxationRewardPoint,aTime+=200;break;case 1:if(!heartRateRunning)continue;const n=parseInt(t.values[e].hr);if(!isNaN(n)){hrvChart.series[0].data.length>=1500?hrvChart.series[0].addPoint([bTime,n],!0,!0):hrvChart.series[0].addPoint([bTime,n],!0,!1),bTime+=200,null==initHr&&(initHr=n);const e=hrvVideo.currentTime>0&&!hrvVideo.paused&&!hrvVideo.ended&&hrvVideo.readyState>hrvVideo.HAVE_CURRENT_DATA;"none"!==hrvVideoContainer.style.display?e&&hrvVideo.pause():hrvIframe.contentWindow.postMessage('{"event":"command","func":"pauseVideo","args":""}',"*"),0!==_el(".HeartRateBody2").getBoundingClientRect().width&&initHr<n&&("none"!==hrvVideoContainer.style.display?e||hrvVideo.play().then((()=>{})):hrvIframe.contentWindow.postMessage('{"event":"command","func":"playVideo","args":""}',"*"))}const l=t.values[e].v_p_p_e;if(isNaN(l))continue;const r=parseFloat(t.values[e].v_p_p_e),i=parseFloat(t.values[e].l_p_p_e),o=parseFloat(t.values[e].h_p_p_e);i>o&&i>r&&(hrv_lf_dominantCount++,mindBodyBalanceRewardPoint++),hrvBar.series[0].update({data:[{name:"VLF%",y:r},{name:"LF%",y:i},{name:"HF%",y:o}]});const s=Math.round(hrv_lf_dominantCount/(bTime/200)*200)/10;_el("#charge").style.height=(s>100?100:s)+"%",_el("#mindBodyBalancePoint").innerHTML=mindBodyBalanceRewardPoint,_el(".heartRateLfDomIValue").innerHTML=s.toFixed(1);const d=0!==o?(i/o*5).toFixed(2):0;_el("#RelaxationLevelValue").innerHTML=d,sliderPercent.innerHTML=d+"%",sliderCircle.style.left=d+"%";break;case 2:if(!tempRunning)continue;const u=parseInt(t.values[e].tmp);if(isNaN(u))continue;if(null===initTemp)initTemp=u,initTempInCelsius=(initTemp/100).toFixed(2),initTempInFahrenheit=(initTemp/100*9/5+32).toFixed(2),greatestTempValue=initTemp,tempValue.innerHTML=isCelsius?(u/100).toFixed(2)+" <sup>o</sup>C":(u/100*9/5+32).toFixed(2)+" <sup>o</sup>F",tempChart.series[0].addPoint([cTime,u/100],!0,!1);else{const e=tempVideo.currentTime>0&&!tempVideo.paused&&!tempVideo.ended&&tempVideo.readyState>tempVideo.HAVE_CURRENT_DATA;"none"!==tempVideo.style.display?e&&tempVideo.pause():tempIframe.contentWindow.postMessage('{"event":"command","func":"pauseVideo","args":""}',"*"),0!==_el(".TempVideo").getBoundingClientRect().width&&initTemp<u&&("none"!==tempVideo.style.display?e||tempVideo.play().then((()=>{})):tempIframe.contentWindow.postMessage('{"event":"command","func":"playVideo","args":""}',"*")),isCelsius?(u>greatestTempValue&&(greatestTempValue=u,greatestTempValueInCelsius=(greatestTempValue/100).toFixed(2),bodyRelaxationRewardPoint=((greatestTempValueInCelsius-initTempInCelsius)/.2).toFixed(0)),tempValue.innerHTML=(u/100).toFixed(2)+" <sup>o</sup>C",bodyRelaxationPoint.innerHTML=bodyRelaxationRewardPoint):(u>greatestTempValue&&(greatestTempValue=u,bodyRelaxationRewardPoint=(((u/100*9/5+32).toFixed(2)-initTempInFahrenheit)/.36).toFixed(0)),tempValue.innerHTML=(u/100*9/5+32).toFixed(2)+" <sup>o</sup>F",bodyRelaxationPoint.innerHTML=bodyRelaxationRewardPoint),tempChart.series[0].data.length>=1500?(tempChart.series[0].addPoint([cTime,u/100],!0,!0),tempChart.series[1].addPoint([cTime,u/100*9/5+32],!0,!0)):(tempChart.series[0].addPoint([cTime,u/100],!0,!1),tempChart.series[1].addPoint([cTime,u/100*9/5+32],!0,!1))}initTemp<u?(tempChart.series[0].update({color:"#ffa500"}),tempChart.series[1].update({color:"#ffa500"})):(tempChart.series[0].update({color:"#ff0000"}),tempChart.series[1].update({color:"#ff0000"})),temporaryTemperatureValue<u&&(previousTemperatureValue=u),temporaryTemperatureValue=u,cTime+=200;break;case 3:const c=parseInt(t.values[e].tmp);isNaN(c)||(_el("#MultiTempVal").innerHTML=(c/100).toFixed(1),multiTempChart.series[0].data.length>=1500?multiTempChart.series[0].addPoint([dTime[0],c/100],!0,!0):multiTempChart.series[0].addPoint([dTime[0],c/100],!0,!1));const h=parseInt(t.values[e].gs);isNaN(h)||(_el("#multiArousalValue").innerHTML=(h/100).toFixed(1),multiArousalChart.series[0].data.length>=1500?multiArousalChart.series[0].addPoint([dTime[1],h/100],!0,!0):multiArousalChart.series[0].addPoint([dTime[1],h/100],!0,!1));const m=100*parseInt(t.values[e].hr);isNaN(m)||(_el("#MultiBeatValue").innerHTML=(m/100).toFixed(1),multiBeatChart.series[0].data.length>=1500?multiBeatChart.series[0].addPoint([dTime[2],m/100],!0,!0):multiBeatChart.series[0].addPoint([dTime[2],m/100],!0,!1));const p=100*parseInt(t.values[e].hr);isNaN(p)||(_el("#multiBVPValue").innerHTML=(p/100).toFixed(1),multiBVPChart.series[0].data.length>=1500?multiBVPChart.series[0].addPoint([dTime[2],p/100],!0,!0):multiBVPChart.series[0].addPoint([dTime[2],p/100],!0,!1)),null!==t.values[e].v_p_p_e&&parseFloat(t.values[e].l_p_p_e)>parseFloat(t.values[e].h_p_p_e)&&t.values[e].l_p_p_e>parseFloat(t.values[e].v_p_p_e)&&multi_lf_dominantCount++;const f=Math.round(multi_lf_dominantCount/(dTime[2]/200)*200)/10;_el("#multiChannelBatteryGraph").style.height=(f>100?100:f)+"%",_el(".multiChannelBarGraphValue").innerHTML=f.toFixed(1),dTime[0]+=200,dTime[1]+=200,dTime[2]+=200;break;case 4:if(!breatheRunning)continue}}}function goBack(){if(-1!==currPage){if(document.querySelector("[data-pageindex='"+currPage+"']").style.transform="translateY(100vh)",document.querySelector("[data-pageindex='"+currPage+"']").style.display="none",document.querySelector(".Page").classList.contains("hidden")&&document.querySelector(".Page").classList.remove("hidden"),3!==currPage){const e=document.querySelector("[data-pageindex='"+currPage+"']").querySelector("video"),t=document.querySelector("[data-pageindex='"+currPage+"']").querySelector("audio"),a=e.currentTime>0&&!e.paused&&!e.ended&&e.readyState>e.HAVE_CURRENT_DATA,n=t.currentTime>0&&!t.paused&&!t.ended&&t.readyState>t.HAVE_CURRENT_DATA;a&&e.pause(),e.currentTime=0,n&&t.pause(),t.currentTime=0,document.querySelector("[data-pageindex='"+currPage+"']").querySelector("iframe").contentWindow.postMessage('{"event":"command","func":"pauseVideo","args":""}',"*")}document.querySelector("#TempHideAnimationBtn").click(),document.querySelector("#HeartRateHideAnimationBtn").click(),document.querySelector("#arousalMinimizeAnimationBtn").click(),document.querySelector("#BalanceHideAnimationBtn").click(),document.querySelector(".arousalButtons").querySelector(".PauseBtn").click(),document.querySelector(".arousalButtons").querySelector(".StopBtn").click(),document.querySelector(".arousalButtons").querySelector(".PlayBtn").style.display="none",document.querySelector(".HeartRateButtons").querySelector(".PauseBtn").click(),document.querySelector(".HeartRateButtons").querySelector(".StopBtn").click(),document.querySelector(".HeartRateButtons").querySelector(".PlayBtn").style.display="none",document.querySelector(".TempHeadCont").querySelector(".PauseBtn").click(),document.querySelector(".TempHeadCont").querySelector(".StopBtn").click(),document.querySelector(".TempHeadCont").querySelector(".PlayBtn").style.display="none",document.querySelector(".BloodPressureTitleButtons").querySelector(".PauseBtn").click(),document.querySelector(".BloodPressureTitleButtons").querySelector(".StopBtn").click(),document.querySelector(".BloodPressureTitleButtons").querySelector(".PlayBtn").style.display="none",document.querySelector(".AudioFile").value="none",0===currPage?arousalRunning=!1:1===currPage?heartRateRunning=!1:2===currPage?tempRunning=!1:4===currPage&&(breatheRunning=!1),currActive=-1,currPage=-1}}function loadArousal(){arousalChart=window.Highcharts.chart("arousalGraph",{legend:{enabled:!1},title:{text:"",style:{color:"#ffffff"}},xAxis:{type:"datetime",isDirty:!0,labels:{format:"{value:%H:%M:%S}",style:{color:"#ffffff"}},title:{text:"Time reading in seconds",style:{color:"#ffffff"}}},yAxis:{labels:{style:{color:"#ffffff"}},title:{text:"Arousal value",style:{color:"#ffffff"}},gridLineColor:"#fff3"},plotOptions:{series:{enableMouseTracking:!1,states:{hover:{enabled:!1}}}},tooltip:{enabled:!1,valueDecimals:2,shared:!0,headerFormat:"Session_time: {point.x:%H:%M:%S}<br/>"},rangeSelector:{enabled:!1},chart:{panning:!0,alignTicks:!1,backgroundColor:"rgba(0,0,0,0)"},navigator:{enabled:!1},scrollbar:{enabled:!1},series:[{data:[],zoneAxis:"y",marker:{enabled:!1},type:"spline"}]})}function renderBreatheCircle(){const e=_el("#curBreatheCircle"),t=10,a=parseFloat(_el("#InhaleVal").innerHTML),n=parseFloat(_el("#Hold1Val").innerHTML),l=parseFloat(_el("#ExhaleVal").innerHTML),r=(parseFloat(_el("#Hold2Val").innerHTML),(_el("#HeartRatePacerGraph").getBoundingClientRect().width-20)/curBreatheTotalTime);curBreatheTime<a?(e.setAttribute("cx",t+curBreatheTime*r),e.setAttribute("cy",t+130*(1-curBreatheTime/a))):curBreatheTime<a+n?(e.setAttribute("cx",t+r*a+(curBreatheTime-a)*r),e.setAttribute("cy",t)):curBreatheTime<a+n+l?(e.setAttribute("cx",r*(a+n)+(curBreatheTime-a-n)*r),e.setAttribute("cy",t+(curBreatheTime-a-n)/l*130)):(e.setAttribute("cx",r*(a+n+l)+(curBreatheTime-a-l-n)*r),e.setAttribute("cy",140))}function changeBreathePerMinute(){_el("#breatherate").innerHTML="Pacer rate="+60/curBreatheTotalTime+" breaths per minute"}function renderBreathePath(){calcBreatheTotalTime(),changeBreathePerMinute();const e=10,t=_el("#HeartRatePacerGraph").getBoundingClientRect().width;_el("#BreatheSVG").setAttribute("height",150),_el("#BreatheSVG").setAttribute("width",t);const a=parseFloat(_el("#InhaleVal").innerHTML),n=parseFloat(_el("#Hold1Val").innerHTML),l=parseFloat(_el("#ExhaleVal").innerHTML),r=parseFloat(_el("#Hold2Val").innerHTML),i=(t-20)/curBreatheTotalTime,o="M10 140 L"+(i*a+e)+" "+"10 L"+i*(a+n)+" "+"10 L"+i*(a+n+l)+" 140 L"+i*(a+n+l+r)+" 140";_el("#BreathePath").setAttribute("d",o),curBreatheTime=0,renderBreatheCircle()}function loadHRV(){hrvChart=window.Highcharts.stockChart("hrvChart",{title:{text:"Heart rate- דופק",style:{color:"#ffffff"}},xAxis:{type:"datetime",labels:{format:"{value:%H:%M:%S}",style:{color:"#ffffff"}}},yAxis:{labels:{style:{color:"#ffffff"}},title:{text:""},gridLineColor:"#ffffff"},plotOptions:{series:{enableMouseTracking:!1,states:{hover:{enabled:!1}}}},tooltip:{enabled:!1,valueDecimals:2,shared:!0,headerFormat:"Session_time: {point.x:%H:%M:%S}<br/>"},rangeSelector:{enabled:!1},chart:{panning:!0,alignTicks:!1,backgroundColor:"rgba(0,0,0,0)"},navigator:{enabled:!1},scrollbar:{enabled:!1},series:[{data:[],type:"spline",color:"#ff0000"}]}),null==hrvBar&&(hrvBar=window.Highcharts.chart("HeartRateBarGraph",{title:{text:""},chart:{type:"column",backgroundColor:"rgba(0,0,0,0)",animation:!1},xAxis:{type:"category",labels:{style:{color:"#ffffff"}}},yAxis:{title:{text:"",style:{color:"#ffffff"}},labels:{style:{color:"#ffffff"}},gridLineColor:"#ffffff"},legend:{enabled:!1},plotOptions:{series:{enableMouseTracking:!1,borderWidth:0,dataLabels:{enabled:!0,format:"{point.y:.1f}"}}},tooltip:{headerFormat:'<span style="font-size:11px">{series.name}</span><br>',pointFormat:'<span style="color:{point.color}">{point.name}</span>: <b>{point.y:.2f}%</b> of total<br/>'},series:[{name:"",colorByPoint:!0,data:[{name:"VLF%",y:0,color:"#7cb5ec",pointWidth:30},{name:"LF%",y:0,color:"#90ed7d",pointWidth:50},{name:"HF%",y:0,color:"#b026ff",pointWidth:30}]}]}))}function loadTemp(){tempChart=window.Highcharts.stockChart("TempGraph",{title:{text:"",style:{color:"#ffffff"}},xAxis:{type:"datetime",labels:{format:"{value:%H:%M:%S}",style:{color:"#ffffff"}}},yAxis:{labels:{style:{color:"#ffffff"}},title:{text:""},gridLineColor:"#FFF3"},plotOptions:{series:{enableMouseTracking:!1,states:{hover:{enabled:!1}}}},tooltip:{enabled:!1,valueDecimals:2,shared:!0,headerFormat:"Session_time: {point.x:%H:%M:%S}<br/>"},rangeSelector:{enabled:!1},chart:{panning:!0,alignTicks:!1,backgroundColor:"rgba(0,0,0,0)"},navigator:{enabled:!1},scrollbar:{enabled:!1},series:[{name:"Celcius",data:[],type:"spline",color:"#ff0000"},{name:"Farenheit",data:[],visible:!1,color:"#ffa500",type:"spline"}]})}function loadBloodPressure(){bloodPressureChart1_2=window.Highcharts.stockChart("BloodPressureSubGraph2",{xAxis:{type:"datetime",labels:{format:"{value:%H:%M:%S}",style:{color:"#ffffff"}}},yAxis:{labels:{style:{color:"#ffffff"}},title:{text:""},gridLineColor:"#FFF3"},plotOptions:{series:{enableMouseTracking:!1,states:{hover:{enabled:!1}}}},tooltip:{enabled:!1,valueDecimals:2,shared:!0,headerFormat:"Session_time: {point.x:%H:%M:%S}<br/>"},rangeSelector:{enabled:!1},chart:{panning:!0,alignTicks:!1,backgroundColor:"rgba(0,0,0,0)"},navigator:{enabled:!1},scrollbar:{enabled:!1},series:[{name:"Blood Pressure 2",data:[],color:{linearGradient:{x1:0,y1:0,x2:0,y2:1},stops:[[0,"blue"],[.5,"green"],[1,"red"]]}}]}),bloodPressureChart2=window.Highcharts.stockChart("BloodPressureMainGraph",{xAxis:{type:"datetime",labels:{format:"{value:%H:%M:%S}",style:{color:"#ffffff"}}},title:{text:"Blood preassure - לחץ דם",style:{color:"#ffffff"}},yAxis:[{labels:{style:{color:"#FF0000"}},title:{text:""},gridLineColor:"#FFF3"},{labels:{style:{color:"#ffffff"}},title:{text:""},gridLineColor:"#FFF3"}],plotOptions:{series:{enableMouseTracking:!1,states:{hover:{enabled:!1}}}},tooltip:{enabled:!1,valueDecimals:2,shared:!0,headerFormat:"Session_time: {point.x:%H:%M:%S}<br/>"},rangeSelector:{enabled:!1},chart:{panning:!0,alignTicks:!1,backgroundColor:"rgba(0,0,0,0)"},navigator:{enabled:!1},scrollbar:{enabled:!1},series:[{name:"Beats per minute",color:"#ff0000",data:[],type:"spline"},{name:"Breaths per minute",color:"#ffffff",data:[],yAxis:1,type:"spline"}]}),null==balanceBar&&(balanceBar=window.Highcharts.chart("BloodPressureBarGraph",{chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,type:"pie",backgroundColor:"rgba(0,0,0,0)",width:100,animation:!1,height:200},title:{text:"%lf dominant",style:{color:"#ffffff",fontSize:"14px"}},series:[{name:"Value",colorByPoint:!0,animation:!1,data:[{name:"%lf dominant",y:100,color:"#90ed7d"},{name:"",y:0,color:"transparent"}]}]}))}function loadMultiChannel(){multiArousalChart=window.Highcharts.chart("MultiChannelArousalChart",{legend:{enabled:!1},title:{text:"Arousal",style:{color:"#ffffff"}},xAxis:{type:"datetime",labels:{format:"{value:%H:%M:%S}",style:{color:"#FFF"}}},yAxis:{labels:{style:{color:"#ffffff"}},title:{text:""},gridLineColor:"#FFF3"},plotOptions:{series:{enableMouseTracking:!1,states:{hover:{enabled:!1}}}},tooltip:{enabled:!1,valueDecimals:2,shared:!0,headerFormat:"Session_time: {point.x:%H:%M:%S}<br/>"},rangeSelector:{enabled:!1},chart:{panning:!0,alignTicks:!1,backgroundColor:"rgba(0,0,0,0)"},navigator:{enabled:!1},scrollbar:{enabled:!1},series:[{data:[],color:"#a1c696",marker:{enabled:!1},type:"spline"}]}),multiTempChart=window.Highcharts.chart("MultiChannelTempChart",{legend:{enabled:!1},title:{text:"Temperature",style:{color:"#ffffff"}},xAxis:{type:"datetime",labels:{format:"{value:%H:%M:%S}",style:{color:"#ffffff"}}},yAxis:{labels:{style:{color:"#ffffff"}},title:{text:""},gridLineColor:"#FFF3"},plotOptions:{series:{enableMouseTracking:!1,states:{hover:{enabled:!1}}}},tooltip:{enabled:!1,valueDecimals:2,shared:!0,headerFormat:"Session_time: {point.x:%H:%M:%S}<br/>"},rangeSelector:{enabled:!1},chart:{panning:!0,alignTicks:!1,backgroundColor:"rgba(0,0,0,0)"},navigator:{enabled:!1},scrollbar:{enabled:!1},series:[{data:[],color:"#FFA500",marker:{enabled:!1},type:"spline"}]}),multiBeatChart=window.Highcharts.chart("MultiChannelBeatChart",{title:{text:"Heart Rate",style:{color:"#ffffff"}},xAxis:{type:"datetime",labels:{format:"{value:%H:%M:%S}",style:{color:"#ffffff"}}},yAxis:{labels:{style:{color:"#ffffff"}},title:{text:""},lineColor:"#F00",gridLineColor:"#FFF3"},plotOptions:{series:{enableMouseTracking:!1,states:{hover:{enabled:!1}}}},tooltip:{enabled:!1,valueDecimals:2,shared:!0,headerFormat:"Session_time: {point.x:%H:%M:%S}<br/>"},rangeSelector:{enabled:!1},chart:{panning:!0,alignTicks:!1,backgroundColor:"rgba(0,0,0,0)"},legend:{enabled:!1},navigator:{enabled:!1},scrollbar:{enabled:!1},series:[{data:[],color:"#ffa500",marker:{enabled:!1},type:"spline"}]}),multiBVPChart=window.Highcharts.chart("MultiChannelBVPChart",{xAxis:{type:"datetime",labels:{format:"{value:%H:%M:%S}",style:{color:"#ffffff"}}},title:{text:"BVP",style:{color:"#ffffff"}},yAxis:[{labels:{style:{color:"#FF0000"}},title:{text:""},gridLineColor:"#FFF3"},{labels:{style:{color:"#ffffff"}},title:{text:""},gridLineColor:"#FFF3"}],plotOptions:{series:{enableMouseTracking:!1,states:{hover:{enabled:!1}}}},tooltip:{enabled:!1,valueDecimals:0,shared:!0,headerFormat:"Session_time: {point.x:%H:%M:%S}<br/>"},rangeSelector:{enabled:!1},chart:{panning:!0,alignTicks:!1,backgroundColor:"rgba(0,0,0,0)"},navigator:{enabled:!1},scrollbar:{enabled:!1},series:[{name:"Heart Rates per minute",color:"#ff0000",data:[],type:"spline"},{name:"Breaths per minute",color:"#ffffff",data:[],yAxis:1,type:"spline"}]})}function calcBreatheTotalTime(){const e=parseFloat(_el("#InhaleVal").innerHTML),t=parseFloat(_el("#Hold1Val").innerHTML),a=parseFloat(_el("#ExhaleVal").innerHTML),n=parseFloat(_el("#Hold2Val").innerHTML);curBreatheTotalTime=e+t+n+a,curMultiBreatheTime=e+t+n+a}function renderMultiBreathePath(){calcBreatheTotalTime(),curMultiBreatheTotalTime=parseFloat(_el("#InhaleVal").innerHTML)+parseFloat(_el("#Hold1Val").innerHTML)+parseFloat(_el("#ExhaleVal").innerHTML)+parseFloat(_el("#Hold2Val").innerHTML),changeBreathePerMinute()}function renderMultiBreatheCircle(){const e=_el("#multiChannelCurBreatheCircle"),t=parseFloat(_el("#MultiInhaleVal").innerHTML),a=parseFloat(_el("#MultiHold1Val").innerHTML),n=parseFloat(_el("#MultiExhaleVal").innerHTML),l=(parseFloat(_el("#MultiHold2Val").innerHTML),10),r=(_el("#multiChannelPacerGraph").getBoundingClientRect().width-20)/curMultiBreatheTotalTime;curMultiBreatheTime<t?(e.setAttribute("cx",l+curMultiBreatheTime*r),e.setAttribute("cy",l+110*(1-curMultiBreatheTime/t))):curMultiBreatheTime<t+a?(e.setAttribute("cx",l+r*t+(curMultiBreatheTime-t)*r),e.setAttribute("cy",l)):curMultiBreatheTime<t+a+n?(e.setAttribute("cx",r*(t+a)+(curMultiBreatheTime-t-a)*r),e.setAttribute("cy",l+(curMultiBreatheTime-t-a)/n*110)):(e.setAttribute("cx",r*(t+a+n)+(curMultiBreatheTime-t-n-a)*r),e.setAttribute("cy",120))}function expand(e){e.style.display="none",e.parentNode.children[1].style.display="block",_el(".multiChannelBreathsCont").style.display="none";const t=e.parentNode.parentNode.parentNode.children;for(let a=0;a<t.length;a++)t[a]!==e.parentNode.parentNode&&(t[a].style.display="none");const a=e.parentNode.parentNode.querySelector(".graphCont");null!==e.parentNode.parentNode.querySelector("#MultiChannelArousalChart")?null!=multiArousalChart&&multiArousalChart.setSize(a.getBoundingClientRect().width,a.getBoundingClientRect().height-20,!1):null!==e.parentNode.parentNode.querySelector("#MultiChannelTempChart")?null!==multiTempChart&&multiTempChart.setSize(a.getBoundingClientRect().width,a.getBoundingClientRect().height-20,!1):null!==e.parentNode.parentNode.querySelector("#MultiChannelBeatChart")?null!==multiBeatChart&&multiBeatChart.setSize(a.getBoundingClientRect().width,a.getBoundingClientRect().height-20,!1):null!==e.parentNode.parentNode.querySelector("#MultiChannelBVPChart")&&null!==multiBVPChart&&multiBVPChart.setSize(a.getBoundingClientRect().width,a.getBoundingClientRect().height-20,!1)}function shrink(e){e.style.display="none",e.parentNode.children[0].style.display="block",_el(".multiChannelBreathsCont").style.display="block";const t=e.parentNode.parentNode.parentNode.children;for(let e=0;e<t.length;e++)t[e].style.display="flex";const a=_el("#MultiChannelArousalChart").parentNode;null!==multiArousalChart&&multiArousalChart.setSize(a.getBoundingClientRect().width-20,a.getBoundingClientRect().height-20,!1),null!==multiTempChart&&multiTempChart.setSize(a.getBoundingClientRect().width-20,a.getBoundingClientRect().height-20,!1),null!==multiBeatChart&&multiBeatChart.setSize(a.getBoundingClientRect().width-20,a.getBoundingClientRect().height-20,!1),null!==multiBVPChart&&multiBVPChart.setSize(a.getBoundingClientRect().width-20,a.getBoundingClientRect().height-20,!1)}function mentalGymInit(){const e=_el("#firstVideo"),t=_el("#secondVideo"),a=_el(".initialAnimation"),n=_el(".tap_to_unmute");e.currentTime>0&&!e.paused&&!e.ended&&e.readyState>e.HAVE_CURRENT_DATA||e.play().then((()=>{})),e.addEventListener("ended",(()=>{e.style.display="none";t.currentTime>0&&!t.paused&&!t.ended&&t.readyState>t.HAVE_CURRENT_DATA||t.play().then((()=>{})),a.style.backgroundColor="#d3def4"})),t.addEventListener("ended",(()=>{a.style.display="none"})),document.querySelectorAll(".backButton").forEach(((e,t)=>{e.addEventListener("click",goBack)})),a.addEventListener("click",(()=>{n.style.display="none",t.muted=!1}));let l=null;iframeReloadInterval=setInterval((()=>{!1===iframeLoaded?(_el("iframe").src="abc",l=requestAnimationFrame((()=>{_el("iframe").src="http://localhost:8080"}))):(l&&cancelAnimationFrame(l),clearInterval(iframeReloadInterval))}),1e3),_el("#showAllGraphs").addEventListener("click",(()=>{setActivePage(3),showSelectedPage(selIndex),requestAnimationFrame((()=>{setPageHidden()}))})),window.onpopstate=goBack;const r=_el("#arousalMinimizeAnimationBtn"),i=_el("#arousalShowAnimationBtn"),o=_el("#arousalGraph"),s=_el(".arousalBodyCont").querySelector(".videoCont");r.addEventListener("click",(()=>{s.style.display="none",r.style.display="none",i.style.display="block",null!==arousalChart&&arousalChart.setSize(o.getBoundingClientRect().width,o.getBoundingClientRect().height,!1)})),r.click(),i.addEventListener("click",(()=>{s.style.display="block",i.style.display="none",r.style.display="block",_el("#arousalChosenItemText").innerHTML="Choose Your Animation",arousalVideo.src="",window.innerWidth<768?null!==arousalChart&&arousalChart.setSize(o.getBoundingClientRect().width,o.getBoundingClientRect().height,!1):null!==arousalChart&&arousalChart.setSize(o.getBoundingClientRect().width/2,o.getBoundingClientRect().height,!1)}));const d=_el("#BalanceHideAnimationBtn"),u=_el("#BalanceShowAnimationBtn"),c=_el("#BloodPressureSubGraph2"),h=_el(".BloodPressureRow1").querySelector(".videoCont");d.addEventListener("click",(()=>{h.style.display="none",d.style.display="none",u.style.display="block",null!==bloodPressureChart1_2&&bloodPressureChart1_2.setSize(c.getBoundingClientRect().width,c.getBoundingClientRect().height,!1)})),d.click(),u.addEventListener("click",(()=>{h.style.display="block",u.style.display="none",d.style.display="block",null!==bloodPressureChart1_2&&bloodPressureChart1_2.setSize(c.getBoundingClientRect().width,c.getBoundingClientRect().height,!1)})),_el("#StartArousalButton").addEventListener("click",(()=>{arousalRunning=!0,setActivePage(0),showSelectedPage(selIndex),requestAnimationFrame((()=>{setPageHidden()}))}));const m=_el("#StartArousalSoundButton"),p=_el("#PauseArousalSoundButton");m.addEventListener("click",(()=>{isSoundEnable=!0,p.style.display="block",m.style.display="none"})),p.addEventListener("click",(()=>{isSoundEnable=!1,m.style.display="block",p.style.display="none"}));const f=_el("#InhaleVal"),g=_el("#ExhaleVal"),y=_el("#Hold1Val"),C=_el("#Hold2Val");f.innerHTML=getCookie("hrv_inhale"),g.innerHTML=getCookie("hrv_exhale"),y.innerHTML=getCookie("hrv_hold"),C.innerHTML=getCookie("hrv_hold2"),_el("#IncInhaleBtn").addEventListener("click",(()=>{updateCookie(f,"hrv_inhale",1)})),_el("#DecInhaleBtn").addEventListener("click",(()=>{updateCookie(f,"hrv_inhale",-1)})),_el("#IncHold1Btn").addEventListener("click",(()=>{updateCookie(y,"hrv_hold",1)})),_el("#DecHold1Btn").addEventListener("click",(()=>{updateCookie(y,"hrv_hold",-1)})),_el("#IncExhaleBtn").addEventListener("click",(()=>{updateCookie(g,"hrv_exhale",1)})),_el("#DecExhaleBtn").addEventListener("click",(()=>{updateCookie(g,"hrv_exhale",-1)})),_el("#IncHold2Btn").addEventListener("click",(()=>{updateCookie(C,"hrv_hold2",1)})),_el("#DecHold2Btn").addEventListener("click",(()=>{updateCookie(C,"hrv_hold2",-1)}));const T=_el("#HeartRatePacerStartButton"),b=_el("#HeartRatePacerStopButton");T.addEventListener("click",(()=>{b.style.pointerEvents="all",T.style.pointerEvents="none";let e=new Date;breathingInterval=setInterval((()=>{curBreatheTime+=(new Date-e)/1e3,e=new Date,curBreatheTime>curBreatheTotalTime&&(e=new Date,curBreatheTime=0,renderMultiBreatheCircle()),renderBreatheCircle()}),30)})),b.addEventListener("click",(()=>{b.style.pointerEvents="none",T.style.pointerEvents="all",curBreatheTime=0,clearInterval(breathingInterval),renderBreatheCircle()})),window.addEventListener?window.addEventListener("message",handleMessage,!1):window.attachEvent&&window.attachEvent("onmessage",handleMessage),_el("#StartHeartRateButton").addEventListener("click",(()=>{heartRateRunning=!0,setActivePage(1),showSelectedPage(selIndex),requestAnimationFrame((()=>{setPageHidden()}))}));const B=_el("#HeartRateShowAnimationBtn"),_=_el("#HeartRateHideAnimationBtn");B.addEventListener("click",(()=>{hrvVideoContainer.style.display="block",B.style.display="none",_.style.display="block",renderBreathePath()})),_.addEventListener("click",(()=>{hrvVideoContainer.style.display="none",B.style.display="block",_.style.display="none"})),_.click(),_el("#StartTempButton").addEventListener("click",(()=>{tempRunning=!0,setActivePage(2),showSelectedPage(selIndex),requestAnimationFrame((()=>{setPageHidden()}))}));const v=_el("#TempShowAnimationBtn"),S=_el("#TempHideAnimationBtn"),P=_el("#TempBody2"),V=_el("#TempBodyCont"),A=_el(".TempGraph");v.addEventListener("click",(()=>{P.style.display="block",_el("#tempChosenItemText").innerHTML="Choose Your Animation",tempVideo.src="",null!==tempChart&&(window.innerWidth<768?tempChart.setSize(V.getBoundingClientRect().width,A.getBoundingClientRect().height,!1):tempChart.setSize(V.getBoundingClientRect().width/2,A.getBoundingClientRect().height,!1)),v.style.display="none",S.style.display="block"})),S.addEventListener("click",(()=>{P.style.display="none",v.style.display="block",S.style.display="none",null!==tempChart&&tempChart.setSize(V.getBoundingClientRect().width,A.getBoundingClientRect().height,!1)})),S.click();const H=_el("#StartBreatheButton"),x=_el("#PauseBreatheButton");H.addEventListener("click",(()=>{breatheRunning=!0,setActivePage(4),H.style.display="none",x.style.display="block"})),x.addEventListener("click",(()=>{breatheRunning=!1,H.style.display="block",x.style.display="none","none"!==bloodPressureVideo.style.display?bloodPressureVideo.pause():bloodPressureIframe.contentWindow.postMessage('{"event":"command","func":"pauseVideo","args":""}',"*")}));const M=_el("#tempChange");M.addEventListener("click",(()=>{isCelsius=!isCelsius,isCelsius?(M.innerHTML="F",null!==tempChart&&(tempChart.series[0].show(),tempChart.series[1].hide())):(M.innerHTML="C",null!==tempChart&&(tempChart.series[1].show(),tempChart.series[0].hide()))})),new audioClass(_el(".arousalButtons")),new audioClass(_el(".HeartRateButtons")),new audioClass(_el(".TempHeadCont")),new audioClass(_el(".BloodPressureTitleButtons")),new videoDropDown(_el(".arousalAnimVideo")),new videoDropDown(_el(".TempVideo")),new videoDropDown(_el(".heartRateAnimVideo")),new videoDropDown(_el(".balanceAnimVideo")),new GuidedClass(_el(".HeartRatePacerButtons"))}window.addEventListener("DOMContentLoaded",(()=>{mentalGymInit()}));